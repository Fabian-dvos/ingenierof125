param([switch])

Stop = "Stop"

 = Get-Clipboard -Raw
 =  -replace "", ""

 =  -split "
" | Where-Object {  -notmatch '^\s*`' }
 =  | Select-String -Pattern '^diff --git ' | Select-Object -First 1
if (-not ) { throw "No encontré 'diff --git' en el portapapeles. Copiá el patch completo." }

 = .LineNumber - 1
 = ([..(.Length-1)] -join "
") + "
"

if () {  | git apply -R --whitespace=fix }
else {  | git apply --whitespace=fix }

if ( -ne 0) { throw "git apply falló (exit=). El patch NO se aplicó." }

Write-Host "OK: patch aplicado." -ForegroundColor Green
